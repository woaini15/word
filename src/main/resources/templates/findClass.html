<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>班级管理</title>
	<script type="text/javascript" src="../layuicms/js/jquery-2.1.1.js"></script>
	<link rel="stylesheet" href="../layuicms/layui/css/layui.css">
	<script type="text/javascript" src="../layuicms/layui/layui.js"></script>
	<script type="text/javascript" src="../layuicms/js/cache.js"></script>
</head>
<body>
	<div class="layui-fluid layui-form"><br/>
		<input type="hidden" id="classid"/>
		<div class='layui-row'>
			<form class="layui-form">
				<div class="layui-col-sm2" style="font-size: 20px;"><i class="layui-icon" style="margin-right: 10px;">&#xe705;</i>班级管理</div>
				<div class="layui-col-sm2">
					<button type="button" class="layui-btn layui-btn-sm" id="btnAdd"><i class="layui-icon">&#xe654;</i>添加</button>
				</div>
			</form>
		</div>
		<hr/>
		<!--  查询班级信息表  -->
		<div class="layui-row">
			<table id="rcved" lay-filter="rcved" class="layui-table"></table>
			<script type="text/html" id="barDemo">
				<a class="layui-btn  layui-btn-normal layui-btn-xs" lay-event="detail"><i class="layui-icon">&#xe705;</i>编辑</a>
  				<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i class="layui-icon">&#xe640;</i>删除</a>
			</script>
		</div>
	</div>
</body>
<script type="text/javascript">
	layui.use('table', function() {
		var laytable = layui.table;
		laytable.render({
			elem : '#rcved',
			url : "/teach/findClass",
			method : "post",
			//cellMinWidth: 80,
			width : "100%",
			height : 400,
			page : true,//开启分页
			size : 'sm',
			limit : 10,//默认50条数据一页
			limits : [ 10, 20, 30, 40 ], //数据分页条
			id : 'testReload',
			cols : [ [{
			    checkbox: true,
					fixed: true
			}, {
				field : "classid",
				title : "班级编号",
				align : 'center',
				sort : true
			}, {
				field : "classname",
				title : "班级名称",
				align : 'center',
				sort : true
			}, {
				field : "tname",
				title : "老师姓名",
				align : 'center',
				sort : true
			},{
				fixed  : "right",
				title : "操作",
				align : 'center',
				toolbar : '#barDemo'
			} ] ]
		});
        laytable.on('checkbox(rcved)', function(obj){
            var data = obj.data; //获得当前行数据
            var classid=data.classid;
            //把子页面的classid值给父页面的classid，parent代表父页面
            parent.$("#classid").val(classid);
            //--关闭 当前页面 开始--
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        });
		//监听工具条
		laytable.on('tool(rcved)', function(obj) { //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
			var data = obj.data; //获得当前行数据
			var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
			var tr = obj.tr; //获得当前行 tr 的DOM对象
			if (layEvent === 'detail') { //编辑
				var id=$("#classid").val(data.classid);
				layer.open({
					type : 2,
					title : '编辑班级信息',
					//maxmin: true, //最大最小窗口
					offset : 'auto',//位置居中
					//shadeClose: true, //点击遮罩关闭层
					shade : 0, //不显示遮罩
					area : [ '350px','250px' ],
					content : '/teach/editClass'//弹框显示的url,对应的页面
				});
			} else if(obj.event === 'del'){
				layer.confirm('真的删除信息吗?', function(index){
					$("#classid").val(data.classid);
					$.ajax({
						type:"post",
						url:"/teach/delClass",
						data:{
							id:data.classid
						},
						success:function(reqData){
							if(reqData>0){
								layer.msg('删除成功', {icon: 1,time: 1000});
							}else {
								layer.msg('删除失败', {icon: 2,time: 1000});
							}
						},
						error:function(){
							layer.msg('ajax执行错误！', {icon: 2,time: 1000});
						}
					});
					obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
					layer.close(index);
					//向服务端发送删除指令
				});
			}
		});
	});
</script>
  <script type="text/javascript">
  	//点击添加弹出添加页面
  	$("document").ready(function(){
  		$("#btnAdd").click(function(){
  			layer.open({
  			    type: 2,
  			    title: '添加班级信息',
  			    maxmin: true, //最大最小窗口
  			    offset: 'auto',//位置居中
  			    shadeClose: true, //点击遮罩关闭层
  			    shade: 0.5,  //不显示遮罩
  			    area:['350px','250px'],    //宽   高
  			    content:'/teach/showadd' //弹框显示的url,对应的页面
  			});
  		});
  	});
  </script>
</html>
