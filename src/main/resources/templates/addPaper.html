<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>添加考试试卷</title>
	<link rel="stylesheet" href="../layuicms/layui/css/layui.css"></link>
	<script type="text/javascript" src="../layuicms/js/jquery-2.1.1.js"></script>
	<script type="text/javascript" src="../layuicms/layui/layui.js"></script>
</head>
<body>
<div class="layui-container layui-form"><br/>
    <div class="layui-form">
        <div class="layui-row">
            <div class="layui-col-sm6">
                <div class="layui-form-item">
                    <div class="layui-col-sm12">
                        <table class="layui-hide" id="LAY_table_user" lay-filter="user"></table>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-row">
            <div class="layui-col-sm6">
                <div class="layui-form-item">
                    <label class="layui-form-label">试卷日期</label>
                    <div class="layui-input-block">
                        <input type="text" name="pdate" id="pdate" lay-verify="date" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-row">
            <div class="layui-col-sm6">
                <div class="layui-form-item">
                    <label class="layui-form-label">考试班级</label>
                    <div class="layui-input-block">
                        <input type="text" name="classid" id="classid" required  lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <button id="Stafff" class="layui-btn layui-btn-primary layui-btn-md ">
                <i class="layui-icon layui-icon-search " ></i>
            </button>
        </div>
        <div class="layui-row">
            <div class="layui-col-sm6">
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn layui-btn-sm" id="btnChu"><i class="layui-icon">&#xe654;</i>出题</button>
                        <button class="layui-btn layui-btn-sm" id="btnCancel"><i class="layui-icon">&#x1006;</i>取消</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript">
    $("document").ready(function(){
    });
</script>
<script type="text/javascript">
    //点击取消时关闭子页面
    $("document").ready(function(){
        $("#btnCancel").click(function(){
            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
            parent.layer.close(index);//关闭弹出的子页面窗口
        });
    });
</script>
<script>
    layui.use(['element', 'table', 'form', 'jquery', 'laydate','layer'], function () {
        var table = layui.table;         //表格
        var form = layui.form;           //表单
        var layer = layui.layer;         //弹层
        var $ = layui.jquery;
        laydate = layui.laydate;
        //日期
        laydate.render({
            elem: '#pdate',
            type:'date',
            value:new Date()
        });

        //方法级渲染
        var ins1=table.render({
            elem: '#LAY_table_user'
            ,url: '/teach/findWordaController'
            ,where: {
            }
            ,cols: [
                [
                {checkbox: true, fixed: true}
                ,{field:'wordid', align:'center',title: '单词序号',  sort: true, fixed: true}
                ,{field:'word', align:'center', title: '单词'}
                ,{field:'wordmeaning', align:'center', title: '汉语意思'}
            ]
            ],
            type:"post",
            limit : 5,//默认50条数据一页
            limits : [5,10,20,30] //数据分页条
            ,id: 'testReload'
            ,page: true
            ,height: 315
            ,done: function (res, curr, count) {
                exportData=res.data;
            }
        });
        var wordid =[];
        table.on('checkbox(user)', function(obj){
            var data = obj.data; //获得当前行数据
            wordid.push(data.wordid);
            var classid=$("#classid").val();
        });
        $("#btnChu").click(function(){
            console.log(wordid);
            $.ajax({
                type:"post",
                url:"/teach/addPaperController",
                data:{
                    lengt:wordid.length,
                    wordid:JSON.stringify(wordid),
                    classid:$("#classid").val(),
                    pdate:$("#pdate").val()
                },
                dataType:"JSON",
                success:function(data){
                    if(data>0){
                        layer.msg('添加成功', {icon: 1,time: 1000},
                            function(){
                                window.location.href = "/teach/showPaper";
                            });
                    }else {
                        layer.msg('添加失败', {icon: 2,time: 1000},
                            function(){

                            });
                    }
                },
                error:function(){
                    layer.msg('ajax执行错误！', {icon: 2,time: 1000});
                }
            });
        });
        var $ = layui.$, active = {
            reload: function(){

                //执行重载
                table.reload('testReload', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    ,where: {
                    }
                });
            }
        };
        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
    });
</script>
<script type="text/javascript">

    $("document").ready(function(){
        $("#Stafff").click(function(){
            layer.open({
                type: 2,
                title: '班级信息',
                //maxmin: true, //最大最小窗口
                offset: 'auto',//位置居中
                //shadeClose: true, //点击遮罩关闭层
                shade: 0,  //不显示遮罩
                area:['1000px' , '550px'],
                content:'/teach/get'//弹框显示的url,对应的页面
            });
        });
    });
</script>
</html>
