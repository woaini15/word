<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript" src="../layuicms/js/jquery-2.1.1.js"></script>
    <link rel="stylesheet" href="../layuicms/layui/css/layui.css">
    <script type="text/javascript" src="../layuicms/layui/layui.js"></script>
    <script type="text/javascript" src="../layuicms/js/cache.js"></script>
</head>
<body>
<div class="layui-container layui-form"><br/>
    <input type="hidden" id="id"/>
    <div class="layui-form">
        <div class="layui-row">
            <div class="layui-col-sm3">
                <div class="layui-form-item">
                    <label class="layui-form-label">班级名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="classname" id="classname" class="layui-input">
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-row">
            <div class="layui-col-sm3">
                <div class="layui-form-item">
                    <label class="layui-form-label">老师编号</label>
                    <div class="layui-input-block">
                        <select  name="tid" id="tid">
                            <option value="0">请选择...</option>
                            <option th:each="t1:${obj}" th:value="${t1.teaid}" th:text="${t1.tname}"></option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-row" style="text-align: right;">
            <div class="layui-col-sm3">
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn layui-btn-sm" id="btnSave"><i class="layui-icon">&#xe605;</i>保存</button>
                        <button class="layui-btn layui-btn-sm" id="btnCancel"><i class="layui-icon">&#x1006;</i>取消</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
<script type="text/javascript">
    //点击取消时关闭子页面
    $("document").ready(function(){
        $("#btnCancel").click(function(){
            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
            parent.layer.close(index);//关闭弹出的子页面窗口
        });
    });
</script>
<script>
    layui.use('form', function(){
        var form = layui.form;
        form.render();
    });
    $("document").ready(function(){
        $("#id").val(parent.$('#classid').val());
        $.ajax({
            type : "POST",
            url: "/teach/find",
            dataType: "json",
            data:{
                id:$("#id").val()
            },
            success : function(data) {
                $("#classname").val(data.classname),
                $("[name='tid'] option[value='"+data.teaid+"']").attr("selected","true");
                layui.use(['form'], function () {
                    $ = layui.jquery;
                    var form = layui.form;
                    form.render(); //刷新select选择框渲染
                });

            },

        });
        $("#btnSave").click(function(){
                $.ajax({
                    type:"post",
                    url:"/teach/updClass",
                    data:{
                        classid:$("#id").val(),
                        classname:$("#classname").val(),
                        teaid:$("#tid").val()
                    },
                    dataType:"json",
                    success:function(data){
                        if(data>0){
                            layer.msg('修改成功', {icon: 1,time: 1000},
                                function(){
                                    parent.location.reload();
                                });
                        }else {
                            layer.msg('修改失败', {icon: 2,time: 1000},
                                function(){
                                    parent.location.reload();
                                });
                        }
                    },
                    error:function(){
                        layer.msg('ajax执行错误！', {icon: 2,time: 1000});
                    }
                });
        });
    });
</script>