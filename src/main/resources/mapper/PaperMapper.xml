<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.word.mapper.PaperMapper">
	<!--学生登录-->
    <select id="findStudents" resultType="String" parameterType="String" >
		{call selstuid(#{semail},#{sname}, #{spass})}
	</select>
	<!--查询密码-->
	<select id="findSpass" resultType="int" parameterType="String" >
		select count(1) from students where stuid=#{stuid} and spass=#{spass};
	</select>
	<!--修改密码-->
	<update id="updSpass">
		update students set spass=#{spass} where stuid=#{stuid};
	</update>
	<!--根据学号查姓名-->
	<select id="findSname" resultType="String" parameterType="String" >
		select sname from students where stuid=#{stuid}
	</select>
	<!--查询统计图的数据-->
	<select id="findEchars" resultType="Echars" parameterType="String" >
		select count(*) as num,writedate from writea where stuid=#{stuid} group by writedate order by writedate desc LIMIT 0,7
	</select>
	<!-- 根据试卷号查询单词 -->
	<resultMap type="Worda" id="wordid">
		<id property="wordid" column="wordid"/>
		<result property="wordmeaning" column="wordmeaning"/>
		<result property="word" column="word"/>
	</resultMap>
	<resultMap type="Paper" id="findwordpaper">
		<id property="pid" column="pid"/>
		<result property="pnum" column="pnum"/>
		<result property="pdate" column="pdate"/>
		<result property="username" column="username"/>
		<collection property="worda" ofType="Worda" resultMap="wordid"/>
	</resultMap>
	<select id="findPaperList" resultType="Paper" parameterType="String" resultMap="findwordpaper">
		select a.pid,b.wordmeaning,b.word from paper a,worda b where a.wordid=b.wordid and a.pnum=#{pnum}
	</select>

	<!-- 根据试卷号查询试卷信息-->
	<resultMap type="Theclass" id="theclass">
		<id property="classid" column="classid"/>
		<result property="classname" column="classname"/>
		<result property="teaid" column="teaid"/>
	</resultMap>
	<resultMap type="Paper" id="findpaper">
		<id property="pid" column="pid"/>
		<result property="pnum" column="pnum"/>
		<result property="pdate" column="pdate"/>
		<result property="username" column="username"/>
		<association property="the" javaType="Theclass" resultMap="theclass"></association>
	</resultMap>
	<select id="findPapername" resultType="Paper" parameterType="String" resultMap="findpaper">
		select a.pnum,a.pdate,a.username,b.classname,b.classid,b.teaid from paper a,theclass b where a.classid=b.classid and a.pnum=#{pnum} limit 0,1
	</select>

	<!-- 我的测试试卷号查询 -->
	<select id="findPnum" resultType="Paper" parameterType="String">
		select pnum from paper where classid=(select stuclass from students where stuid=#{stuid}) and pdate=date(now()) and pnum like 'T%' group by pnum
	</select>
	<!-- 添加默写信息 -->
	<insert id="addWritea">
		insert into writea(pid,writeword,isyes,writedate,stuid,stuclass,pnum) values(#{pid},#{writeword},#{isyes},#{writedate},#{stuid},#{stuclass},#{pnum});
	</insert>
	<!-- 添加分数信息 -->
	<insert id="addMark">
		insert into mark(stuid,stuclass,mark,markdate,isflag,remark,pnum) values(#{stuid},#{stuclass},#{mark},#{markdate},#{isflag},#{remark},#{pnum});
	</insert>
	<!-- 查询测试试卷号 -->
	<select id="findTMark" resultType="Mark" >
		select * from mark where stuid=#{stuid} and pnum like 'T%' limit #{page},#{countPage};
	</select>
	<!-- 查询测试试卷号 -->
	<select id="countTMark" resultType="int" parameterType="String">
		select count(*) from mark where stuid=#{stuid} and pnum like 'T%' ;
	</select>
	<!-- 查询错题 -->
	<select id="findError" resultType="Writea">
		select a.writeword,c.wordmeaning,c.word from writea a,paper b,worda c where	a.pid=b.pid and b.wordid=c.wordid and a.isyes=0 and stuid=#{stuid} and a.pnum=#{pnum}
	</select>
	<!-- 我的练习试卷号查询 -->
	<select id="findSPnum" resultType="Paper" parameterType="String">
		select pnum from paper where pnum in(select pnum from writea where stuid=#{stuid} and pnum like 'S%' order by writedate desc) group by pnum
	</select>
	<!-- 查询随机单词 -->
	<select id="findWorda" resultType="Worda" parameterType="String" >
		SELECT * FROM worda ORDER BY RAND() LIMIT 10;
	</select>

	<!-- 添加随机试卷 -->
	<insert id="addPaper">
		insert into paper(pnum,wordid,pdate,classid,username) values(#{pnum},#{wordid},#{pdate},#{classid},#{username});
	</insert>
</mapper>